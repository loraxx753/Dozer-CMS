// Generated by CoffeeScript 1.6.2
(function() {
  var save_text;

  save_text = function($el) {
    var content, d;

    content = $el.parent().prev();
    d = "disabled";
    if ($el.hasClass(d)) {
      $el.text("Saved");
      $el.removeClass(d).removeAttr(d);
      return $el.removeClass("btn-info").addClass("btn-success");
    } else {
      $el.addClass(d).removeClass("btn-success").addClass("btn-info").attr(d, d);
      $el.text("Saving...");
      return $.post("/admin/update/content", {
        name: $(content).attr("id"),
        content: $(content).html()
      }, function(data) {
        return save_text($el);
      });
    }
  };

  $(".hallo_edit").click(function(e) {
    e.preventDefault();
    if ($(this).hasClass("btn-primary")) {
      $(this).removeClass("btn-primary").addClass("btn-danger").text("Stop Editing");
      $(".editable").addClass("active");
      $(".editable").after('<p><button class="btn btn-success pull-right hallo_save" data-loading-text="Saving...">Save</button></p>');
      $('.editable').hallo({
        plugins: {
          'halloformat': {},
          'halloblock': {},
          'hallojustify': {},
          'hallolists': {},
          'hallolink': {},
          'halloreundo': {},
          'halloimage': {
            upload: function(data) {
              return console.log("success");
            },
            uploadUrl: "/admin/imageupload"
          }
        },
        editable: true,
        toolbar: 'halloToolbarFixed'
      });
      return $("#page_content").on("click", ".hallo_save", "click", function(e) {
        e.preventDefault;
        return save_text($(this));
      });
    } else {
      $(this).removeClass("btn-danger").addClass("btn-primary").text("Edit");
      $(".hallo_save").parent().remove();
      $(".editable").removeClass("active");
      return jQuery('.editable').hallo({
        editable: false
      });
    }
  });

  $("#publish_page").on("click", function() {
    var $el, d;

    d = "disabled";
    $el = $(this);
    if (page_is_published === true) {
      $el.addClass(d).attr(d, d);
      $el.text("Un-Publishing...");
      return $.post("admin/update/publish", {
        clean_name: current_page,
        publish: 0
      }, function(data) {
        $el.text("Publish");
        $el.removeClass(d).removeAttr(d);
        $el.removeClass("btn-warning").addClass("btn-primary");
        return window.page_is_published = false;
      });
    } else {
      $el.addClass(d).attr(d, d);
      $el.text("Publishing...");
      return $.post("admin/update/publish", {
        clean_name: current_page,
        publish: 1
      }, function(data) {
        $el.removeClass("btn-primary").addClass("btn-warning");
        $el.text("Un-Publish");
        $el.removeClass(d).removeAttr(d);
        $el.removeClass("btn-primary").addClass("btn-warning");
        return window.page_is_published = true;
      });
    }
  });

  $("#add_content_block").on("click", function() {
    $("body").append("<div id='modal_dump'></div>");
    return $("#modal_dump").load("/assets/snippets/contentblock.html", function() {
      $('#myModal').modal();
      return $('#contentBlockSave').on("click", function(e) {
        e.preventDefault();
        return $.post("admin/create/block", {
          "name": $("#contentBlockName").val(),
          "page": window.current_page
        }, function(data) {
          return $("#page_content").append(data);
        });
      });
    });
  });

}).call(this);
